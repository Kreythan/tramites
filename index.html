<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Ventas - Pagina Principal</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; justify-content: center; padding: 20px; }
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 850px; }
        h2 { text-align: center; color: #1a73e8; margin-bottom: 25px; border-bottom: 2px solid #e8f0fe; padding-bottom: 10px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; }
        .field { display: flex; flex-direction: column; }
        label { font-size: 13px; margin-bottom: 6px; font-weight: bold; color: #444; }
        input, select, textarea { padding: 12px; border: 1px solid #ced4da; border-radius: 12px; font-size: 14px; transition: 0.3s; }
        input:focus, select:focus { border-color: #1a73e8; box-shadow: 0 0 0 3px rgba(26,115,232,0.1); outline: none; }
        input[readonly] { background-color: #f8f9fa; color: #6c757d; border-style: dashed; }
        .input-bs { position: relative; }
        .input-bs input { padding-left: 40px; }
        .input-bs::before { content: "Bs."; position: absolute; left: 12px; top: 38px; color: #6c757d; font-weight: bold; z-index: 1; }
        .msg-obs { color: #d93025; font-size: 11px; margin-top: 5px; font-style: italic; display: none; font-weight: bold; }
        .btn-save { grid-column: 1 / -1; background: #1a73e8; color: white; border: none; padding: 15px; border-radius: 25px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 20px; transition: 0.3s; }
        .btn-save:hover { background: #1557b0; }
        .btn-save:disabled { background: #a5c6f1; cursor: not-allowed; }
        .nav-link { display: block; text-align: center; margin-top: 25px; color: #1a73e8; text-decoration: none; font-weight: 500; }
    </style>
</head>
<body>

<div class="card">
    <h2>Pagina Principal</h2>
    <form id="registroForm">
        <div class="grid">
            <div class="field"><label>Fecha</label><input type="date" id="fecha" readonly></div>
            <div class="field"><label>Hora</label><input type="time" id="hora" readonly></div>
            <div class="field"><label>Placa *</label><input type="text" id="placa" required placeholder="Ej: 1234ABC"></div>
            <div class="field"><label>Nombre Cliente *</label><input type="text" id="nombre_cliente" required></div>

            <div class="field input-bs"><label>Dra G *</label><input type="number" id="dra_g" step="0.01" required oninput="calcularSaldo()"></div>
            
            <div class="field">
                <label>Metodo de Pago 1 *</label>
                <select id="metodo_pago_1" required onchange="verificarMetodo(this, 'msg1')">
                    <option value="">Seleccione...</option>
                    <option value="Efectivo">Efectivo</option>
                    <option value="QR">QR</option>
                    <option value="Efectivo y QR">Efectivo y QR</option>
                </select>
                <span id="msg1" class="msg-obs">‚ö†Ô∏è agregar los montos en Obs</span>
            </div>

            <div class="field input-bs"><label>Dn Victor *</label><input type="number" id="dn_victor" step="0.01" required oninput="calcularSaldo()"></div>

            <div class="field">
                <label>Metodo de Pago 2 *</label>
                <select id="metodo_pago_2" required onchange="verificarMetodo(this, 'msg2')">
                    <option value="">Seleccione...</option>
                    <option value="Efectivo">Efectivo</option>
                    <option value="QR">QR</option>
                    <option value="Efectivo y QR">Efectivo y QR</option>
                </select>
                <span id="msg2" class="msg-obs">‚ö†Ô∏è agregar los montos en Obs</span>
            </div>

            <div class="field input-bs"><label>Saldo </label><input type="text" id="saldo" readonly value="0.00"></div>
            
            <div class="field" style="grid-column: span 2;"><label>Obs (Opcional)</label><textarea id="observaciones" rows="3" placeholder="Detalles adicionales aqu√≠..."></textarea></div>

            <button type="submit" class="btn-save" id="btnGuardar">Guardar Registro</button>
        </div>
    </form>
    <a href="busqueda.html" class="nav-link">üîé Ir a P√°gina de B√∫squeda</a>
</div>

<script>
    // URL DEL SCRIPT DE GOOGLE (Reemplaza con la tuya)
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzhBQFVdWSu2UWmQK4ljSu8_2vicPq4DCYsfXBSwfd2XKUIT54ibdCBpJ9e9Ek0u7cl/exec';

    // 1. Cargar Fecha y Hora autom√°ticas al abrir
   // Cargar Fecha y Hora autom√°ticas para Santa Cruz, Bolivia
// Cargar Fecha y Hora autom√°ticas para Santa Cruz, Bolivia
window.onload = () => {
    const ahora = new Date();
    
    // Obtener fecha YYYY-MM-DD ajustada a Bolivia
    const fechaBO = ahora.toLocaleDateString('en-CA', { timeZone: "America/La_Paz" });
    
    // Obtener hora HH:mm ajustada a Bolivia
    const horaBO = ahora.toLocaleTimeString('es-BO', { 
        hour: '2-digit', 
        minute: '2-digit', 
        hour12: false,
        timeZone: "America/La_Paz" 
    });

    document.getElementById('fecha').value = fechaBO;
    document.getElementById('hora').value = horaBO;
};

    // 2. Calcular Saldo autom√°ticamente
    function calcularSaldo() {
        const draG = parseFloat(document.getElementById('dra_g').value) || 0;
        const dnVictor = parseFloat(document.getElementById('dn_victor').value) || 0;
        const total = draG - dnVictor;
        document.getElementById('saldo').value = total.toFixed(2);
    }

    // 3. Mostrar mensaje si es Efectivo y QR
    function verificarMetodo(select, msgId) {
        const msg = document.getElementById(msgId);
        msg.style.display = (select.value === "Efectivo y QR") ? "block" : "none";
    }

    // 4. ENV√çO DE DATOS A GOOGLE SHEETS
    document.getElementById('registroForm').onsubmit = async (e) => {
        e.preventDefault();
        
        const btn = document.getElementById('btnGuardar');
        btn.disabled = true;
        btn.innerText = 'Guardando en la Nube...';

        // Estructura de datos seg√∫n los encabezados de tu hoja
       // Dentro de tu funci√≥n enviarDatos en index.html
        const data = {
            fecha: document.getElementById('fecha').value.toString(), // Forzamos a que sea texto
            hora: document.getElementById('hora').value.toString(),
            placa: document.getElementById('placa').value.toString(),
                // ... resto de los campos
            nombre_cliente: document.getElementById('nombre_cliente').value,
            dra_g: "Bs. " + document.getElementById('dra_g').value,
            metodo_pago_1: document.getElementById('metodo_pago_1').value,
            dn_victor: "Bs. " + document.getElementById('dn_victor').value,
            metodo_pago_2: document.getElementById('metodo_pago_2').value,
            saldo: "Bs. " + document.getElementById('saldo').value,
            observaciones: document.getElementById('observaciones').value
        };

        try {
            // Env√≠o al Apps Script
            await fetch(scriptURL, { 
                method: 'POST', 
                mode: 'no-cors', // Necesario para evitar bloqueos de Google
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data) 
            });

            alert('‚úÖ Registro guardado con √©xito');
            
            // LIMPIAR FORMULARIO
            document.getElementById('registroForm').reset();
            
            // Actualizar fecha y hora para el siguiente registro
            const n = new Date();
            document.getElementById('fecha').value = n.toISOString().split('T')[0];
            document.getElementById('hora').value = n.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('saldo').value = "0.00";
            document.getElementById('msg1').style.display = 'none';
            document.getElementById('msg2').style.display = 'none';

        } catch (error) {
            console.error('Error:', error);
            alert('‚ùå Hubo un problema al guardar. Int√©ntalo de nuevo.');
        } finally {
            btn.disabled = false;
            btn.innerText = 'Guardar Registro';
        }
    };
</script>

</body>
</html>







